---
title: "Семинар 2. Решения."
author: "Алла Тамбовцева"
output: html_document
---

## Часть 1

1. Поставьте библиотеку [randomNames](https://cran.r-project.org/web/packages/randomNames/randomNames.pdf). Обратитесь к ней через `library()`.

```{r, eval=FALSE}
install.packages("randomNames")
```

```{r, warning=FALSE, message=FALSE}
library(randomNames)
```

2. Создайте вектор из 100 испанских имен:

```{r}
set.seed(1234) # чтобы у всех получались одинаковые результаты
names <- randomNames(100, which.names = "first", ethnicity = 4)
```

3. Будем считать, что эти 100 имен – имена опрошенных респондентов. Создайте вектор со значениями возраста респондентов:

```{r}
ages <- sample(16:75, 100, replace = TRUE) # replace = TRUE - с повторяющимися значениями
```

А также вектор `polit` – политические взгляды респондентов:

```{r}
views <- c("right", "left", "moderate", "indifferent")
polit <- sample(views, 100, replace = TRUE)
```

Создайте из полученных трёх векторов датафрейм.

```{r}
info <- cbind.data.frame(names, ages, polit)
head(info)
```

4. Создайте столбец `id` с номерами респондентов.

```{r}
info$id <- 1:100
```

5. Определите, сколько среди респондентов людей в возрасте от 25 до 30 лет (включительно). Определите, какую долю респондентов в нашей сымпровизированной выборке составляют люди в возрасте от 25 до 30 лет. Выразите эту долю в процентах.

```{r}
n <- nrow(info[info$ages >= 25 & info$ages <= 30, ])
n

# доля в процентах
n / nrow(info) * 100
```

6. Создайте «факторный» вектор политических взглядов `polit_views`. Сколько у полученного фактора уровней? Добавьте в датафрейм столбец `polit_views`.

```{r}
info$polit_views <- factor(info$polit)
```

## Часть 2

1. Загрузите файл `Firms.csv`. Почитать про базу можно [здесь](https://www.rdocumentation.org/packages/car/versions/2.1-5/topics/Ornstein). Посмотрите на таблицу.

```{r}
df <- read.csv("Firms.csv")
```

2. Сколько в датафрейме наблюдений? Сколько переменных? Какие это переменные?

```{r}
str(df)
```

3. Сколько в датафрейме полностью заполненных строк (наблюдений)? Выведите (если такие есть) наблюдения, содержащие пропущенные значения на экран.

```{r}
# полностью
nrow(df[complete.cases(df), ])

# содержащие NA - таких нет
nrow(df[!complete.cases(df), ])
```

4. Отфильтруйте наблюдения в таблице согласно следующим критериям:

    * фирмы с активами от 10000 до 20000 (включительно);
    
```{r}
# способ 1
dat1 <- df[df$assets >= 10000 & df$assets <= 20000, ]

# способ 2
dat1 <- subset(df, assets >= 10000 & assets <= 20000)
```
   
    * фирмы, число управляющих позиций, совместных с другими фирмами, которых не превышает 30;
    
```{r}
# способ 1
dat2 <- df[df$interlocks <= 30, ]

# способ 2
dat2 <- subset(df, interlocks <= 30)
```

    * фирмы транспортного сектора (`TRN`) под руководством управляющих из Канады (`CAN`);

```{r}
# 1 способ
dat3 <- df[df$sector == "TRN" & df$nation == "CAN", ]

# 2 способ
dat3 <- subset(df, sector == "TRN" & nation == "CAN")
```

5. Создате переменную «натуральный логарифм активов» (`log_assets`) и добавьте её в датафрейм.

```{r}
df$log_assets <- log(df$assets)
```

6. Постройте график, который может проиллюстрировать, какие паттерны пропущенных наблюдений можно зафиксировать в таблице.

```{r}
# неактуально - таких нет
```

7. Удалите пропущенные значения из базы данных.

```{r}
# тоже не очень актуально, но пусть будет
df <- na.omit(df)
```

8. Сохраните измененную базу данных в формате Stata (файл `“Firms.dta”`)

```{r, message=FALSE, warning=FALSE}
library(foreign)
write.dta(df, "Firms.dta")
```

